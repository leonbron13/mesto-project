(()=>{"use strict";var e={},t=document.querySelector(".profile-popup"),n=t.querySelector(".form"),r=document.querySelector(".profile__edit-button"),o=document.querySelectorAll(".popup__close-button"),c=(document.querySelector(".cards").children,document.querySelector(".popup__sample")),u=document.querySelector(".profile__add-button"),a=(document.querySelector(".profile__close-button"),document.querySelector(".popup__confirm-button"),document.querySelector(".popup__input-name")),i=document.querySelector(".popup__input-status"),l=document.querySelector(".profile__name"),s=document.querySelector(".profile__status"),d=document.getElementById("gallery"),f=(document.getElementById("card-template").content.querySelector(".card"),document.querySelector("#popup-picture")),p=f.querySelector("#picture-image"),m=f.querySelector("#picture-title"),_=document.getElementById("form-card"),v=_.querySelector("#card-name"),y=_.querySelector("#card-link"),h=document.querySelector(".popup__avatar"),S=h.querySelector(".form"),b=h.querySelector(".popup__avatar_form"),q=b.querySelector(".form__button"),E=b.querySelector("#avatar-link"),k=document.querySelector(".profile__avatar-edit"),L=document.querySelectorAll(".popup__overlay"),g=document.querySelector(".profile__avatar"),C=document.querySelector(".popup-confirm"),A=document.querySelector(".form__submit"),x=(document.querySelector(".popup__save-button"),document.querySelector(".adding_button")),w=document.querySelector("#card-template").content,T=Array.from(document.querySelectorAll(".form")),j=(document.querySelector(".popup_type_delete-card"),document.querySelector(".popup__sample")),I=j.querySelector(".form");function D(e,t){e.checkValidity()?(t.classList.remove("invalid"),t.disabled=!1):(t.classList.add("invalid"),t.disabled=!0)}var O,P={baseUrl:"https://nomoreparties.co/v1/plus-cohort-28/",headers:{authorization:"422b5d5f-9eba-4d80-aea6-bb78210d1ac5","Content-Type":"application/json"}};function U(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function B(e,t,n){return fetch("".concat(e.baseUrl).concat(n),{method:t,headers:e.headers})}function G(e,t,n,r){return fetch("".concat(e.baseUrl).concat(n),{method:t,headers:e.headers,body:JSON.stringify(r)})}function H(e){e.classList.add("popup_opened"),document.addEventListener("keydown",N)}function M(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",N)}function N(e){"Escape"===e.key&&M(document.querySelector(".popup_opened"))}function z(t){var n=w.querySelector(".card").cloneNode(!0),r=n.querySelector(".card__img"),o=n.querySelector(".card__title"),c=n.querySelector(".card__trash"),u=n.querySelector(".card__like-text"),a=n.querySelector(".card__like-button");return r.setAttribute("src",t.link),r.setAttribute("alt",t.name),o.textContent=t.name,u.textContent=t.likes.length,t.likes.forEach((function(t){t._id===e.id&&a.classList.add("card__like-button_checked")})),e.id!==t.owner._id&&c.classList.add("card__trash_hidden"),c.addEventListener("click",(function(){var e;(e=t._id,B(P,"DELETE","cards/".concat(e)).then(U)).then((function(){H(C),A.addEventListener("click",(function(){c.closest(".card").remove(),M(C)}))})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(e){var n,r,o;n=e.target,r=u,o=t._id,n.classList.contains("card__like-button_checked")?function(e){return B(P,"DELETE","cards/likes/".concat(e)).then(U)}(o).then((function(e){r.textContent=e.likes.length,n.classList.remove("card__like-button_checked")})).catch((function(e){console.log(e)})):function(e){return B(P,"PUT","cards/likes/".concat(e)).then(U)}(o).then((function(e){r.textContent=e.likes.length,n.classList.add("card__like-button_checked")})).catch((function(e){console.log(e)}))})),r.addEventListener("click",(function(){H(f),p.src=r.src,p.alt=r.alt,m.textContent=o.textContent})),n}function J(e,t){var n=z(e);t.prepend(n)}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $(e,t){e.textContent=t?"Сохранение...":"Сохранить"}k.addEventListener("click",(function(){H(h)})),o.forEach((function(e){e.addEventListener("click",(function(){M(e.closest(".popup"))}))})),L.forEach((function(e){e.addEventListener("mousedown",(function(){M(e.closest(".popup"))}))})),r.addEventListener("click",(function(){H(t),a.value=l.textContent,i.value=s.textContent})),u.addEventListener("click",(function(){H(j)})),n.addEventListener("submit",(function(e){e.preventDefault(),$(e.submitter,!0);var n={};n.name=a.value,n.about=i.value,function(e){return G(P,"PATCH","users/me",e).then(U)}(n).then((function(e){l.textContent=e.name,s.textContent=e.about,M(t)})).catch((function(e){console.log(e)})).finally((function(){$(e.submitter,!1)}))})),I.addEventListener("submit",(function(e){var t,n;e.preventDefault(),$(e.submitter,!0),(n={},n.name=v.value,n.link=y.value,t=n,G(P,"POST","cards",t).then(U)).then((function(t){J({name:t.name,link:t.link,owner:t.owner,likes:t.likes,_id:t._id},d),e.target.reset(),x.classList.add("invalid"),x.disabled=!0,M(c)})).catch((function(e){console.log(e)})).finally((function(){$(e.submitter,!1)}))})),S.addEventListener("submit",(function(e){e.preventDefault(),$(e.submitter,!0);var t={};t.avatar=E.value,function(e){return G(P,"PATCH","users/me/avatar",e).then(U)}(t).then((function(t){g.src=t.avatar,e.target.reset(),q.classList.add("invalid"),q.disabled=!0,M(h)})).catch((function(e){console.log(e)})).finally((function(){$(e.submitter,!1)}))})),Promise.all([B(P,"GET","users/me").then(U),B(P,"GET","cards").then(U)]).then((function(t){var n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(a.push(r.value),a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(n,r)||function(e,t){if(e){if("string"==typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],u=o[1];e.id=c._id,function(e,t,n){l.textContent=e,s.textContent=t,g.src=n}(c.name,c.about,c.avatar),u.reverse().forEach((function(e){J(e,d)}))})).catch((function(e){console.log(e)})),O={inputSelector:".form__input",inputErrorClass:"form__input_type_error",inputErrorActiveClass:"form__input-error_active",buttonSaveSelector:".popup__save-button",buttonInvalidClass:"invalid"},T.forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.buttonSaveSelector);n.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.inputErrorActiveClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.inputErrorActiveClass)}(e,t,t.validationMessage,n)}(e,n,t),D(e,r)})),D(e,r)}))}(e,O)}))})();